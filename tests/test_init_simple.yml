- name: test yum install
  hosts: all
  become: yes
  become_method: sudo
  gather_facts: yes
  vars:
    - k8s_version: "1.22.2"                                # Kubernetes version to be installed, kubernetes-cni-1.2.0-0.x86_64 is dependent and is installed with them automatical
  tasks:
          # - name: set Fact try
          #debug:
          #var: ansible_facts

    - name: Pull container images
      shell: |
        kubeadm config images pull
      args:
        chdir: $HOME
      when:  ansible_facts['hostname'] == "centos-s-1vcpu-512mb-10gb-fra1-Master"

    - name: init API or controller
      shell: kubeadm init --apiserver-advertise-address 10.114.0.2 --pod-network-cidr=172.16.0.0/16
      register: kubeadm_output
      args:
        chdir: $HOME
        creates: cluster_initialized.txt
      when:  ansible_facts['hostname'] == "centos-s-1vcpu-512mb-10gb-fra1-Master"

    - name: Output to a file
      local_action:
        module: lineinfile
        dest: /root/output.json
        line: '{{ kubeadm_output.stdout }}'
        create: yes
      when:  ansible_facts['hostname'] == "centos-s-1vcpu-512mb-10gb-fra1-Master"

