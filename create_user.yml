- name: Create user on a linux server 
  hosts: kub-servers 
  become: yes 
  gather_facts: false 
  vars: 
    - user: vio 
    - password: vio 

  tasks: 
      - name: Create a login user 
        user: 
          name: "{{ user }}" 
          password: "{{ password }}" 
          groups: 
            - wheel 
          state: present 
  
      - name: Create ssh directory 
        file: 
          path: /home/{{ user }}/.ssh/ 
          state: directory 
  
      - name: Add public key to authorized_keys 
        authorized_key: 
          user: "{{ user }}" 
          state: present 
          key: "{{ lookup('file', '/home/{{ user }}/.ssh/id_rsa.pub') }}" 
  

          #      - name: Add {{ user }} to sudoers file 
          #        ansible.builtin.lineinfile: 
          #          path: /etc/sudoers 
          #         regexp: '^{{ user }}' 
          #          line: '{{ user }} ALL=(ALL) NOPASSWD: ALL' 
          #          validate: 'visudo -cf %s' 

